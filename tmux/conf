set-option -g default-term "screen-256color"
# History
set-option -g history-limit 15000
# Start numbering at 1
set-option -g base-index 1
set-option -g pane-base-index 1
# Faster command sequence
set-option -s escape-time 0
set-option -g repeat-time 205

# Status line
set-option -g status-keys 'vi'
set-option -g status-utf8 on
set-option -g status-style 'bg=colour234'
set-option -ag status-style 'fg=colour214,bold'
set-option -wg window-status-current-fg 'colour204'
set-option -g status-right '#{=21:pane_title}|#(uptime -p|tr -d ",")|%H:%M'
set-option -g status-right-length 52

unbind C-b
set-option -g prefix C-a
bind-key C-a send-prefix

# Last active window
#bind-key C-a last-window
# Root
bind-key R split-window 'exec sudo -s'
# Reload config
bind-key r source-file ~/.tmux.conf \; display-message 'configuration loaded'

# Copy-paste
bind-key P paste-buffer

# Vi-like selection and yank
bind-key -t vi-copy 'v' begin-selection
bind-key -t vi-copy 'y' copy-selection

bind-key -n C-t new-window -a

# Switching windows
bind-key -n S-left  prev
bind-key -n S-right next

# Swap tabs
bind-key -n M-S-left  swap-window -t -1
bind-key -n M-S-right swap-window -t +1

# scrolling
bind-key -t emacs-copy -n 'x' page-up
bind-key -t emacs-copy -n 'j' page-down

# Toggle pane synchronization
bind-key S set-window-option synchronize-panes

bind-key p run '[ -n "$DISPLAY" ] && (pass sudo -c > /dev/null && xdotool type $(xclip -o -selection c) && xdotool key Return)'

# Aggressive resize
setw -g aggressive-resize on

# Nested session mangling
bind-key -n M-F11 set -wg window-status-current-fg 'colour214'
bind-key -n M-F12 set -wg window-status-current-fg 'colour204'

bind-key -n S-up \
  send-keys M-F12 \; \
  unbind -n S-C-left \; \
  unbind -n S-C-right \; \
  unbind -n S-left \; \
  unbind -n S-right \; \
  unbind -n C-t \; \
  set -wg window-status-current-fg 'colour214' \; \
  set -g prefix C-b

bind-key -n S-down \
  send-keys M-F11 \; \
  bind -n S-C-left swap-window -t -1 \; \
  bind -n S-C-right swap-window -t +1 \; \
  bind -n S-left  prev \; \
  bind -n S-right next \; \
  bind -n C-t new-window -a -c "#{pane_current_path}" \; \
  set -wg window-status-current-fg 'colour204' \; \
  set -g prefix C-a

# Smart pane switching with awareness of Vim splits.
# See: https://github.com/christoomey/vim-tmux-navigator
is_vim="ps -o state= -o comm= -t '#{pane_tty}' \
    | grep -iqE '^[^TXZ ]+ +(\\S+\\/)?g?(view|n?vim?x?)(diff)?$'"
bind-key -n C-left if-shell "$is_vim" "send-keys C-h"  "select-pane -L"
bind-key -n C-down if-shell "$is_vim" "send-keys C-j"  "select-pane -D"
bind-key -n C-up if-shell "$is_vim" "send-keys C-k"  "select-pane -U"
bind-key -n C-right if-shell "$is_vim" "send-keys C-l"  "select-pane -R"
bind-key -n C-\ if-shell "$is_vim" "send-keys C-\\" "select-pane -l"

# plugins
set -g @resurrect-capture-pane-contents 'on'
run-shell ~/dotfiles/tmux/plugins/resurrect/resurrect.tmux
